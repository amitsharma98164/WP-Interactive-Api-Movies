{"version":3,"file":"e2e/page-2.js","mappings":"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","sources":["webpack://__experimentalInteractivity/./e2e/page-2/store.js","webpack://__experimentalInteractivity/./src/runtime/constants.js","webpack://__experimentalInteractivity/./src/runtime/vdom.js","webpack://__experimentalInteractivity/./src/runtime/router.js","webpack://__experimentalInteractivity/./src/runtime/store.js","webpack://__experimentalInteractivity/./src/runtime/utils.js"],"sourcesContent":["import { store } from '../../src/runtime/store';\nimport { navigate } from '../../src/runtime/router';\n\nstore({\n\tstate: {\n\t\tnewValue: true,\n\t},\n\tactions: {\n\t\ttoggleNewValue: ({ state }) => {\n\t\t\tstate.newValue = !state.newValue;\n\t\t},\n\t\treplaceWithPage3: () => {\n\t\t\tnavigate('/csn-page-3.html', { replace: true });\n\t\t},\n\t},\n});\n","export const csnMetaTagItemprop = 'wp-client-side-navigation';\nexport const directivePrefix = 'wp';\n","import { h } from 'preact';\nimport { directivePrefix as p } from './constants';\n\nconst ignoreAttr = `data-${p}-ignore`;\nconst islandAttr = `data-${p}-interactive`;\nconst fullPrefix = `data-${p}-`;\n\n// Regular expression for directive parsing.\nconst directiveParser = new RegExp(\n\t`^data-${p}-` + // ${p} must be a prefix string, like 'wp'.\n\t\t// Match alphanumeric characters including hyphen-separated\n\t\t// segments. It excludes underscore intentionally to prevent confusion.\n\t\t// E.g., \"custom-directive\".\n\t\t'([a-z0-9]+(?:-[a-z0-9]+)*)' +\n\t\t// (Optional) Match '--' followed by any alphanumeric charachters. It\n\t\t// excludes underscore intentionally to prevent confusion, but it can\n\t\t// contain multiple hyphens. E.g., \"--custom-prefix--with-more-info\".\n\t\t'(?:--([a-z0-9][a-z0-9-]+))?$',\n\t'i' // Case insensitive.\n);\n\nexport const hydratedIslands = new WeakSet();\n\n// Recursive function that transforms a DOM tree into vDOM.\nexport function toVdom(root) {\n\tconst treeWalker = document.createTreeWalker(\n\t\troot,\n\t\t205 // ELEMENT + TEXT + COMMENT + CDATA_SECTION + PROCESSING_INSTRUCTION\n\t);\n\n\tfunction walk(node) {\n\t\tconst { attributes, nodeType } = node;\n\n\t\tif (nodeType === 3) return [node.data];\n\t\tif (nodeType === 4) {\n\t\t\tconst next = treeWalker.nextSibling();\n\t\t\tnode.replaceWith(new Text(node.nodeValue));\n\t\t\treturn [node.nodeValue, next];\n\t\t}\n\t\tif (nodeType === 8 || nodeType === 7) {\n\t\t\tconst next = treeWalker.nextSibling();\n\t\t\tnode.remove();\n\t\t\treturn [null, next];\n\t\t}\n\n\t\tconst props = {};\n\t\tconst children = [];\n\t\tconst directives = {};\n\t\tlet hasDirectives = false;\n\t\tlet ignore = false;\n\t\tlet island = false;\n\n\t\tfor (let i = 0; i < attributes.length; i++) {\n\t\t\tconst n = attributes[i].name;\n\t\t\tif (\n\t\t\t\tn[fullPrefix.length] &&\n\t\t\t\tn.slice(0, fullPrefix.length) === fullPrefix\n\t\t\t) {\n\t\t\t\tif (n === ignoreAttr) {\n\t\t\t\t\tignore = true;\n\t\t\t\t} else if (n === islandAttr) {\n\t\t\t\t\tisland = true;\n\t\t\t\t} else {\n\t\t\t\t\thasDirectives = true;\n\t\t\t\t\tlet val = attributes[i].value;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tval = JSON.parse(val);\n\t\t\t\t\t} catch (e) {}\n\t\t\t\t\tconst [, prefix, suffix] = directiveParser.exec(n);\n\t\t\t\t\tdirectives[prefix] = directives[prefix] || {};\n\t\t\t\t\tdirectives[prefix][suffix || 'default'] = val;\n\t\t\t\t}\n\t\t\t} else if (n === 'ref') {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tprops[n] = attributes[i].value;\n\t\t}\n\n\t\tif (ignore && !island)\n\t\t\treturn [\n\t\t\t\th(node.localName, {\n\t\t\t\t\t...props,\n\t\t\t\t\tinnerHTML: node.innerHTML,\n\t\t\t\t\t__directives: { ignore: true },\n\t\t\t\t}),\n\t\t\t];\n\t\tif (island) hydratedIslands.add(node);\n\n\t\tif (hasDirectives) props.__directives = directives;\n\n\t\tlet child = treeWalker.firstChild();\n\t\tif (child) {\n\t\t\twhile (child) {\n\t\t\t\tconst [vnode, nextChild] = walk(child);\n\t\t\t\tif (vnode) children.push(vnode);\n\t\t\t\tchild = nextChild || treeWalker.nextSibling();\n\t\t\t}\n\t\t\ttreeWalker.parentNode();\n\t\t}\n\n\t\treturn [h(node.localName, props, children)];\n\t}\n\n\treturn walk(treeWalker.currentNode);\n}\n","import { hydrate, render } from 'preact';\nimport { toVdom, hydratedIslands } from './vdom';\nimport { createRootFragment } from './utils';\nimport { csnMetaTagItemprop, directivePrefix } from './constants';\n\n// The root to render the vdom (document.body).\nlet rootFragment;\n\n// The cache of visited and prefetched pages, stylesheets and scripts.\nconst pages = new Map();\nconst stylesheets = new Map();\nconst scripts = new Map();\n\n// Helper to remove domain and hash from the URL. We are only interesting in\n// caching the path and the query.\nconst cleanUrl = (url) => {\n\tconst u = new URL(url, window.location);\n\treturn u.pathname + u.search;\n};\n\n// Helper to check if a page can do client-side navigation.\nexport const canDoClientSideNavigation = (dom) =>\n\tdom\n\t\t.querySelector(`meta[itemprop='${csnMetaTagItemprop}']`)\n\t\t?.getAttribute('content') === 'active';\n\n/**\n * Finds the elements in the document that match the selector and fetch them.\n * For each element found, fetch the content and store it in the cache.\n * Returns an array of elements to add to the document.\n *\n * @param {Document}         document\n * @param {string}           selector        - CSS selector used to find the elements.\n * @param {'href'|'src'}     attribute       - Attribute that determines where to fetch\n *                                           the styles or scripts from. Also used as the key for the cache.\n * @param {Map}              cache           - Cache to use for the elements. Can be `stylesheets` or `scripts`.\n * @param {'style'|'script'} elementToCreate - Element to create for each fetched\n *                                           item. Can be 'style' or 'script'.\n * @return {Promise<Array<HTMLElement>>} - Array of elements to add to the document.\n */\nconst fetchScriptOrStyle = async (\n\tdocument,\n\tselector,\n\tattribute,\n\tcache,\n\telementToCreate\n) => {\n\tconst fetchedItems = await Promise.all(\n\t\t[].map.call(document.querySelectorAll(selector), (el) => {\n\t\t\tconst attributeValue = el.getAttribute(attribute);\n\t\t\tif (!cache.has(attributeValue))\n\t\t\t\tcache.set(\n\t\t\t\t\tattributeValue,\n\t\t\t\t\tfetch(attributeValue).then((r) => r.text())\n\t\t\t\t);\n\t\t\treturn cache.get(attributeValue);\n\t\t})\n\t);\n\n\treturn fetchedItems.map((item) => {\n\t\tconst element = document.createElement(elementToCreate);\n\t\telement.textContent = item;\n\t\treturn element;\n\t});\n};\n\n// Fetch styles of a new page.\nconst fetchAssets = async (document) => {\n\tconst stylesFromSheets = await fetchScriptOrStyle(\n\t\tdocument,\n\t\t'link[rel=stylesheet]',\n\t\t'href',\n\t\tstylesheets,\n\t\t'style'\n\t);\n\tconst scriptTags = await fetchScriptOrStyle(\n\t\tdocument,\n\t\t'script[src]',\n\t\t'src',\n\t\tscripts,\n\t\t'script'\n\t);\n\tconst moduleScripts = await fetchScriptOrStyle(\n\t\tdocument,\n\t\t'script[type=module]',\n\t\t'src',\n\t\tscripts,\n\t\t'script'\n\t);\n\tmoduleScripts.forEach((script) => script.setAttribute('type', 'module'));\n\n\treturn [\n\t\t...scriptTags,\n\t\tdocument.querySelector('title'),\n\t\t...document.querySelectorAll('style'),\n\t\t...stylesFromSheets,\n\t];\n};\n\n// Fetch a new page and convert it to a static virtual DOM.\nconst fetchPage = async (url) => {\n\tconst html = await window.fetch(url).then((r) => r.text());\n\tconst dom = new window.DOMParser().parseFromString(html, 'text/html');\n\tif (!canDoClientSideNavigation(dom.head)) return false;\n\tconst head = await fetchAssets(dom);\n\treturn { head, body: toVdom(dom.body) };\n};\n\n// Prefetch a page. We store the promise to avoid triggering a second fetch for\n// a page if a fetching has already started.\nexport const prefetch = (url) => {\n\turl = cleanUrl(url);\n\tif (!pages.has(url)) {\n\t\tpages.set(url, fetchPage(url));\n\t}\n};\n\n// Navigate to a new page.\nexport const navigate = async (href, { replace = false } = {}) => {\n\tconst url = cleanUrl(href);\n\tprefetch(url);\n\tconst page = await pages.get(url);\n\tif (page) {\n\t\tdocument.head.replaceChildren(...page.head);\n\t\trender(page.body, rootFragment);\n\t\twindow.history[replace ? 'replaceState' : 'pushState']({}, '', href);\n\t} else {\n\t\twindow.location.assign(href);\n\t}\n};\n\n// Listen to the back and forward buttons and restore the page if it's in the\n// cache.\nwindow.addEventListener('popstate', async () => {\n\tconst url = cleanUrl(window.location); // Remove hash.\n\tconst page = pages.has(url) && (await pages.get(url));\n\tif (page) {\n\t\tdocument.head.replaceChildren(...page.head);\n\t\trender(page.body, rootFragment);\n\t} else {\n\t\twindow.location.reload();\n\t}\n});\n\n// Initialize the router with the initial DOM.\nexport const init = async () => {\n\tif (canDoClientSideNavigation(document.head)) {\n\t\t// Create the root fragment to hydrate everything.\n\t\trootFragment = createRootFragment(\n\t\t\tdocument.documentElement,\n\t\t\tdocument.body\n\t\t);\n\t\tconst body = toVdom(document.body);\n\t\thydrate(body, rootFragment);\n\n\t\t// Cache the scripts. Has to be called before fetching the assets.\n\t\t[].map.call(document.querySelectorAll('script[src]'), (script) => {\n\t\t\tscripts.set(script.getAttribute('src'), script.textContent);\n\t\t});\n\n\t\tconst head = await fetchAssets(document);\n\t\tpages.set(cleanUrl(window.location), Promise.resolve({ body, head }));\n\t} else {\n\t\tdocument\n\t\t\t.querySelectorAll(`[data-${directivePrefix}-interactive]`)\n\t\t\t.forEach((node) => {\n\t\t\t\tif (!hydratedIslands.has(node)) {\n\t\t\t\t\tconst fragment = createRootFragment(node.parentNode, node);\n\t\t\t\t\tconst vdom = toVdom(node);\n\t\t\t\t\thydrate(vdom, fragment);\n\t\t\t\t}\n\t\t\t});\n\t}\n};\n","import { deepSignal } from 'deepsignal';\n\nconst isObject = (item) =>\n\titem && typeof item === 'object' && !Array.isArray(item);\n\nexport const deepMerge = (target, source) => {\n\tif (isObject(target) && isObject(source)) {\n\t\tfor (const key in source) {\n\t\t\tif (isObject(source[key])) {\n\t\t\t\tif (!target[key]) Object.assign(target, { [key]: {} });\n\t\t\t\tdeepMerge(target[key], source[key]);\n\t\t\t} else {\n\t\t\t\tObject.assign(target, { [key]: source[key] });\n\t\t\t}\n\t\t}\n\t}\n};\n\nconst getSerializedState = () => {\n\t// TODO: change the store tag ID for a better one.\n\tconst storeTag = document.querySelector(\n\t\t`script[type=\"application/json\"]#store`\n\t);\n\tif (!storeTag) return {};\n\ttry {\n\t\tconst { state } = JSON.parse(storeTag.textContent);\n\t\tif (isObject(state)) return state;\n\t\tthrow Error('Parsed state is not an object');\n\t} catch (e) {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.log(e);\n\t}\n\treturn {};\n};\n\nconst rawState = getSerializedState();\nexport const rawStore = { state: deepSignal(rawState) };\n\nif (typeof window !== 'undefined') window.store = rawStore;\n\nexport const store = ({ state, ...block }) => {\n\tdeepMerge(rawStore, block);\n\tdeepMerge(rawState, state);\n};\n","import { useRef, useEffect } from 'preact/hooks';\nimport { effect } from '@preact/signals';\n\nfunction afterNextFrame(callback) {\n\tconst done = () => {\n\t\tcancelAnimationFrame(raf);\n\t\tsetTimeout(callback);\n\t};\n\tconst raf = requestAnimationFrame(done);\n}\n\n// Using the mangled properties:\n// this.c: this._callback\n// this.x: this._compute\n// https://github.com/preactjs/signals/blob/main/mangle.json\nfunction createFlusher(compute, notify) {\n\tlet flush;\n\tconst dispose = effect(function () {\n\t\tflush = this.c.bind(this);\n\t\tthis.x = compute;\n\t\tthis.c = notify;\n\t\treturn compute();\n\t});\n\treturn { flush, dispose };\n}\n\n// Version of `useSignalEffect` with a `useEffect`-like execution. This hook\n// implementation comes from this PR:\n// https://github.com/preactjs/signals/pull/290.\n//\n// We need to include it here in this repo until the mentioned PR is merged.\nexport function useSignalEffect(cb) {\n\tconst callback = useRef(cb);\n\tcallback.current = cb;\n\n\tuseEffect(() => {\n\t\tconst execute = () => callback.current();\n\t\tconst notify = () => afterNextFrame(eff.flush);\n\t\tconst eff = createFlusher(execute, notify);\n\t\treturn eff.dispose;\n\t}, []);\n}\n\n// For wrapperless hydration.\n// See https://gist.github.com/developit/f4c67a2ede71dc2fab7f357f39cff28c\nexport const createRootFragment = (parent, replaceNode) => {\n\treplaceNode = [].concat(replaceNode);\n\tconst s = replaceNode[replaceNode.length - 1].nextSibling;\n\tfunction insert(c, r) {\n\t\tparent.insertBefore(c, r || s);\n\t}\n\treturn (parent.__k = {\n\t\tnodeType: 1,\n\t\tparentNode: parent,\n\t\tfirstChild: replaceNode[0],\n\t\tchildNodes: replaceNode,\n\t\tinsertBefore: insert,\n\t\tappendChild: insert,\n\t\tremoveChild(c) {\n\t\t\tparent.removeChild(c);\n\t\t},\n\t});\n};\n"],"names":["store","state","newValue","actions","toggleNewValue","replaceWithPage3","navigate","replace","fullPrefix","directiveParser","RegExp","hydratedIslands","WeakSet","toVdom","root","treeWalker","document","createTreeWalker","walk","node","attributes","nodeType","data","next","nextSibling","replaceWith","Text","nodeValue","remove","props","children","directives","hasDirectives","ignore","island","i","length","n","name","slice","val","value","JSON","parse","e","prefix","suffix","exec","h","localName","innerHTML","__directives","add","child","firstChild","vnode","nextChild","push","parentNode","currentNode","rootFragment","pages","Map","stylesheets","scripts","cleanUrl","url","u","URL","window","location","pathname","search","canDoClientSideNavigation","dom","querySelector","getAttribute","fetchScriptOrStyle","async","selector","attribute","cache","elementToCreate","Promise","all","map","call","querySelectorAll","el","attributeValue","has","set","fetch","then","r","text","get","item","element","createElement","textContent","fetchAssets","stylesFromSheets","scriptTags","forEach","script","setAttribute","prefetch","html","DOMParser","parseFromString","head","body","fetchPage","href","page","replaceChildren","render","history","assign","addEventListener","reload","init","createRootFragment","documentElement","hydrate","resolve","fragment","vdom","isObject","Array","isArray","deepMerge","target","source","key","Object","rawState","storeTag","Error","console","log","getSerializedState","rawStore","deepSignal","block","useSignalEffect","cb","callback","useRef","current","useEffect","eff","compute","notify","flush","dispose","effect","this","c","bind","x","createFlusher","raf","requestAnimationFrame","cancelAnimationFrame","setTimeout","afterNextFrame","parent","replaceNode","s","concat","insert","insertBefore","__k","childNodes","appendChild","removeChild"],"sourceRoot":""}