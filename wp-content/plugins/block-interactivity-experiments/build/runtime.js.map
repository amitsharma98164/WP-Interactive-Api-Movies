{"version":3,"file":"runtime.js","mappings":"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","sources":["webpack://__experimentalInteractivity/./src/runtime/hooks.js","webpack://__experimentalInteractivity/./src/runtime/directives.js","webpack://__experimentalInteractivity/./src/runtime/index.js","webpack://__experimentalInteractivity/./src/runtime/constants.js","webpack://__experimentalInteractivity/./src/runtime/vdom.js","webpack://__experimentalInteractivity/./src/runtime/router.js","webpack://__experimentalInteractivity/./src/runtime/store.js","webpack://__experimentalInteractivity/./src/runtime/utils.js"],"sourcesContent":["import { h, options, createContext, cloneElement } from 'preact';\nimport { useRef, useMemo } from 'preact/hooks';\nimport { rawStore as store } from './store';\n\n// Main context.\nconst context = createContext({});\n\n// WordPress Directives.\nconst directiveMap = {};\nconst directivePriorities = {};\nexport const directive = (name, cb, { priority = 10 } = {}) => {\n\tdirectiveMap[name] = cb;\n\tdirectivePriorities[name] = priority;\n};\n\n// Resolve the path to some property of the store object.\nconst resolve = (path, ctx) => {\n\tlet current = { ...store, context: ctx };\n\tpath.split('.').forEach((p) => (current = current[p]));\n\treturn current;\n};\n\n// Generate the evaluate function.\nconst getEvaluate =\n\t({ ref } = {}) =>\n\t(path, extraArgs = {}) => {\n\t\t// If path starts with !, remove it and save a flag.\n\t\tconst hasNegationOperator = path[0] === '!' && !!(path = path.slice(1));\n\t\tconst value = resolve(path, extraArgs.context);\n\t\tconst returnValue =\n\t\t\ttypeof value === 'function'\n\t\t\t\t? value({\n\t\t\t\t\t\tref: ref.current,\n\t\t\t\t\t\t...store,\n\t\t\t\t\t\t...extraArgs,\n\t\t\t\t  })\n\t\t\t\t: value;\n\t\treturn hasNegationOperator ? !returnValue : returnValue;\n\t};\n\n// Separate directives by priority. The resulting array contains objects\n// of directives grouped by same priority, and sorted in ascending order.\nconst usePriorityLevels = (directives) =>\n\tuseMemo(() => {\n\t\tconst byPriority = Object.entries(directives).reduce(\n\t\t\t(acc, [name, values]) => {\n\t\t\t\tconst priority = directivePriorities[name];\n\t\t\t\tif (!acc[priority]) acc[priority] = {};\n\t\t\t\tacc[priority][name] = values;\n\n\t\t\t\treturn acc;\n\t\t\t},\n\t\t\t{}\n\t\t);\n\n\t\treturn Object.entries(byPriority)\n\t\t\t.sort(([p1], [p2]) => p1 - p2)\n\t\t\t.map(([, obj]) => obj);\n\t}, [directives]);\n\n// Directive wrapper.\nconst Directive = ({ type, directives, props: originalProps }) => {\n\tconst ref = useRef(null);\n\tconst element = h(type, { ...originalProps, ref });\n\tconst evaluate = useMemo(() => getEvaluate({ ref }), []);\n\n\t// Add wrappers recursively for each priority level.\n\tconst byPriorityLevel = usePriorityLevels(directives);\n\treturn (\n\t\t<RecursivePriorityLevel\n\t\t\tdirectives={byPriorityLevel}\n\t\t\telement={element}\n\t\t\tevaluate={evaluate}\n\t\t\toriginalProps={originalProps}\n\t\t/>\n\t);\n};\n\n// Priority level wrapper.\nconst RecursivePriorityLevel = ({\n\tdirectives: [directives, ...rest],\n\telement,\n\tevaluate,\n\toriginalProps,\n}) => {\n\t// This element needs to be a fresh copy so we are not modifying an already\n\t// rendered element with Preact's internal properties initialized. This\n\t// prevents an error with changes in `element.props.children` not being\n\t// reflected in `element.__k`.\n\telement = cloneElement(element);\n\n\t// Recursively render the wrapper for the next priority level.\n\t//\n\t// Note that, even though we're instantiating a vnode with a\n\t// `RecursivePriorityLevel` here, its render function will not be executed\n\t// just yet. Actually, it will be delayed until the current render function\n\t// has finished. That ensures directives in the current priorty level have\n\t// run (and thus modified the passed `element`) before the next level.\n\tconst children =\n\t\trest.length > 0 ? (\n\t\t\t<RecursivePriorityLevel\n\t\t\t\tdirectives={rest}\n\t\t\t\telement={element}\n\t\t\t\tevaluate={evaluate}\n\t\t\t\toriginalProps={originalProps}\n\t\t\t/>\n\t\t) : (\n\t\t\telement\n\t\t);\n\n\tconst props = { ...originalProps, children };\n\tconst directiveArgs = { directives, props, element, context, evaluate };\n\n\tfor (const d in directives) {\n\t\tconst wrapper = directiveMap[d]?.(directiveArgs);\n\t\tif (wrapper !== undefined) props.children = wrapper;\n\t}\n\n\treturn props.children;\n};\n\n// Preact Options Hook called each time a vnode is created.\nconst old = options.vnode;\noptions.vnode = (vnode) => {\n\tif (vnode.props.__directives) {\n\t\tconst props = vnode.props;\n\t\tconst directives = props.__directives;\n\t\tdelete props.__directives;\n\t\tvnode.props = {\n\t\t\ttype: vnode.type,\n\t\t\tdirectives,\n\t\t\tprops,\n\t\t};\n\t\tvnode.type = Directive;\n\t}\n\n\tif (old) old(vnode);\n};\n","import { useContext, useMemo, useEffect } from 'preact/hooks';\nimport { deepSignal, peek } from 'deepsignal';\nimport { useSignalEffect } from './utils';\nimport { directive } from './hooks';\nimport { prefetch, navigate, canDoClientSideNavigation } from './router';\n\n// Check if current page can do client-side navigation.\nconst clientSideNavigation = canDoClientSideNavigation(document.head);\n\nconst isObject = (item) =>\n\titem && typeof item === 'object' && !Array.isArray(item);\n\nconst mergeDeepSignals = (target, source) => {\n\tfor (const k in source) {\n\t\tif (typeof peek(target, k) === 'undefined') {\n\t\t\ttarget[`$${k}`] = source[`$${k}`];\n\t\t} else if (isObject(peek(target, k)) && isObject(peek(source, k))) {\n\t\t\tmergeDeepSignals(target[`$${k}`].peek(), source[`$${k}`].peek());\n\t\t}\n\t}\n};\n\nexport default () => {\n\t// data-wp-context\n\tdirective(\n\t\t'context',\n\t\t({\n\t\t\tdirectives: {\n\t\t\t\tcontext: { default: context },\n\t\t\t},\n\t\t\tprops: { children },\n\t\t\tcontext: inherited,\n\t\t}) => {\n\t\t\tconst { Provider } = inherited;\n\t\t\tconst inheritedValue = useContext(inherited);\n\t\t\tconst value = useMemo(() => {\n\t\t\t\tconst localValue = deepSignal(context);\n\t\t\t\tmergeDeepSignals(localValue, inheritedValue);\n\t\t\t\treturn localValue;\n\t\t\t}, [context, inheritedValue]);\n\n\t\t\treturn <Provider value={value}>{children}</Provider>;\n\t\t},\n\t\t{ priority: 5 }\n\t);\n\n\t// data-wp-effect--[name]\n\tdirective('effect', ({ directives: { effect }, context, evaluate }) => {\n\t\tconst contextValue = useContext(context);\n\t\tObject.values(effect).forEach((path) => {\n\t\t\tuseSignalEffect(() => {\n\t\t\t\treturn evaluate(path, { context: contextValue });\n\t\t\t});\n\t\t});\n\t});\n\n\t// data-wp-on--[event]\n\tdirective('on', ({ directives: { on }, element, evaluate, context }) => {\n\t\tconst contextValue = useContext(context);\n\t\tObject.entries(on).forEach(([name, path]) => {\n\t\t\telement.props[`on${name}`] = (event) => {\n\t\t\t\tevaluate(path, { event, context: contextValue });\n\t\t\t};\n\t\t});\n\t});\n\n\t// data-wp-class--[classname]\n\tdirective(\n\t\t'class',\n\t\t({ directives: { class: className }, element, evaluate, context }) => {\n\t\t\tconst contextValue = useContext(context);\n\t\t\tObject.keys(className)\n\t\t\t\t.filter((n) => n !== 'default')\n\t\t\t\t.forEach((name) => {\n\t\t\t\t\tconst result = evaluate(className[name], {\n\t\t\t\t\t\tclassName: name,\n\t\t\t\t\t\tcontext: contextValue,\n\t\t\t\t\t});\n\t\t\t\t\tconst currentClass = element.props.class || '';\n\t\t\t\t\tconst classFinder = new RegExp(\n\t\t\t\t\t\t`(^|\\\\s)${name}(\\\\s|$)`,\n\t\t\t\t\t\t'g'\n\t\t\t\t\t);\n\t\t\t\t\tif (!result)\n\t\t\t\t\t\telement.props.class = currentClass\n\t\t\t\t\t\t\t.replace(classFinder, ' ')\n\t\t\t\t\t\t\t.trim();\n\t\t\t\t\telse if (!classFinder.test(currentClass))\n\t\t\t\t\t\telement.props.class = currentClass\n\t\t\t\t\t\t\t? `${currentClass} ${name}`\n\t\t\t\t\t\t\t: name;\n\n\t\t\t\t\tuseEffect(() => {\n\t\t\t\t\t\t// This seems necessary because Preact doesn't change the class names\n\t\t\t\t\t\t// on the hydration, so we have to do it manually. It doesn't need\n\t\t\t\t\t\t// deps because it only needs to do it the first time.\n\t\t\t\t\t\tif (!result) {\n\t\t\t\t\t\t\telement.ref.current.classList.remove(name);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telement.ref.current.classList.add(name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, []);\n\t\t\t\t});\n\t\t}\n\t);\n\n\t// data-wp-bind--[attribute]\n\tdirective(\n\t\t'bind',\n\t\t({ directives: { bind }, element, context, evaluate }) => {\n\t\t\tconst contextValue = useContext(context);\n\t\t\tObject.entries(bind)\n\t\t\t\t.filter((n) => n !== 'default')\n\t\t\t\t.forEach(([attribute, path]) => {\n\t\t\t\t\tconst result = evaluate(path, {\n\t\t\t\t\t\tcontext: contextValue,\n\t\t\t\t\t});\n\t\t\t\t\telement.props[attribute] = result;\n\n\t\t\t\t\t// This seems necessary because Preact doesn't change the attributes\n\t\t\t\t\t// on the hydration, so we have to do it manually. It doesn't need\n\t\t\t\t\t// deps because it only needs to do it the first time.\n\t\t\t\t\tuseEffect(() => {\n\t\t\t\t\t\t// aria- and data- attributes have no boolean representation.\n\t\t\t\t\t\t// A `false` value is different from the attribute not being\n\t\t\t\t\t\t// present, so we can't remove it.\n\t\t\t\t\t\t// We follow Preact's logic: https://github.com/preactjs/preact/blob/ea49f7a0f9d1ff2c98c0bdd66aa0cbc583055246/src/diff/props.js#L131C24-L136\n\t\t\t\t\t\tif (result === false && attribute[4] !== '-') {\n\t\t\t\t\t\t\telement.ref.current.removeAttribute(attribute);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telement.ref.current.setAttribute(\n\t\t\t\t\t\t\t\tattribute,\n\t\t\t\t\t\t\t\tresult === true && attribute[4] !== '-'\n\t\t\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t\t\t: result\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, []);\n\t\t\t\t});\n\t\t}\n\t);\n\n\t// data-wp-link\n\tdirective(\n\t\t'link',\n\t\t({\n\t\t\tdirectives: {\n\t\t\t\tlink: { default: link },\n\t\t\t},\n\t\t\tprops: { href },\n\t\t\telement,\n\t\t}) => {\n\t\t\tuseEffect(() => {\n\t\t\t\t// Prefetch the page if it is in the directive options.\n\t\t\t\tif (clientSideNavigation && link?.prefetch) {\n\t\t\t\t\tprefetch(href);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Don't do anything if it's falsy.\n\t\t\tif (clientSideNavigation && link !== false) {\n\t\t\t\telement.props.onclick = async (event) => {\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t// Fetch the page (or return it from cache).\n\t\t\t\t\tawait navigate(href);\n\n\t\t\t\t\t// Update the scroll, depending on the option. True by default.\n\t\t\t\t\tif (link?.scroll === 'smooth') {\n\t\t\t\t\t\twindow.scrollTo({\n\t\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\t\tleft: 0,\n\t\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (link?.scroll !== false) {\n\t\t\t\t\t\twindow.scrollTo(0, 0);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t);\n\n\t// data-wp-show\n\tdirective(\n\t\t'show',\n\t\t({\n\t\t\tdirectives: {\n\t\t\t\tshow: { default: show },\n\t\t\t},\n\t\t\telement,\n\t\t\tevaluate,\n\t\t\tcontext,\n\t\t}) => {\n\t\t\tconst contextValue = useContext(context);\n\n\t\t\tif (!evaluate(show, { context: contextValue }))\n\t\t\t\telement.props.children = (\n\t\t\t\t\t<template>{element.props.children}</template>\n\t\t\t\t);\n\t\t}\n\t);\n\n\t// data-wp-ignore\n\tdirective(\n\t\t'ignore',\n\t\t({\n\t\t\telement: {\n\t\t\t\ttype: Type,\n\t\t\t\tprops: { innerHTML, ...rest },\n\t\t\t},\n\t\t}) => {\n\t\t\t// Preserve the initial inner HTML.\n\t\t\tconst cached = useMemo(() => innerHTML, []);\n\t\t\treturn (\n\t\t\t\t<Type dangerouslySetInnerHTML={{ __html: cached }} {...rest} />\n\t\t\t);\n\t\t}\n\t);\n\n\t// data-wp-text\n\tdirective(\n\t\t'text',\n\t\t({\n\t\t\tdirectives: {\n\t\t\t\ttext: { default: text },\n\t\t\t},\n\t\t\telement,\n\t\t\tevaluate,\n\t\t\tcontext,\n\t\t}) => {\n\t\t\tconst contextValue = useContext(context);\n\t\t\telement.props.children = evaluate(text, { context: contextValue });\n\t\t}\n\t);\n};\n","import registerDirectives from './directives';\nimport { init } from './router';\nexport { store } from './store';\nexport { navigate } from './router';\n\n/**\n * Initialize the Interactivity API.\n */\ndocument.addEventListener('DOMContentLoaded', async () => {\n\tregisterDirectives();\n\tawait init();\n\t// eslint-disable-next-line no-console\n\tconsole.log('Interactivity API started');\n});\n","export const csnMetaTagItemprop = 'wp-client-side-navigation';\nexport const directivePrefix = 'wp';\n","import { h } from 'preact';\nimport { directivePrefix as p } from './constants';\n\nconst ignoreAttr = `data-${p}-ignore`;\nconst islandAttr = `data-${p}-interactive`;\nconst fullPrefix = `data-${p}-`;\n\n// Regular expression for directive parsing.\nconst directiveParser = new RegExp(\n\t`^data-${p}-` + // ${p} must be a prefix string, like 'wp'.\n\t\t// Match alphanumeric characters including hyphen-separated\n\t\t// segments. It excludes underscore intentionally to prevent confusion.\n\t\t// E.g., \"custom-directive\".\n\t\t'([a-z0-9]+(?:-[a-z0-9]+)*)' +\n\t\t// (Optional) Match '--' followed by any alphanumeric charachters. It\n\t\t// excludes underscore intentionally to prevent confusion, but it can\n\t\t// contain multiple hyphens. E.g., \"--custom-prefix--with-more-info\".\n\t\t'(?:--([a-z0-9][a-z0-9-]+))?$',\n\t'i' // Case insensitive.\n);\n\nexport const hydratedIslands = new WeakSet();\n\n// Recursive function that transforms a DOM tree into vDOM.\nexport function toVdom(root) {\n\tconst treeWalker = document.createTreeWalker(\n\t\troot,\n\t\t205 // ELEMENT + TEXT + COMMENT + CDATA_SECTION + PROCESSING_INSTRUCTION\n\t);\n\n\tfunction walk(node) {\n\t\tconst { attributes, nodeType } = node;\n\n\t\tif (nodeType === 3) return [node.data];\n\t\tif (nodeType === 4) {\n\t\t\tconst next = treeWalker.nextSibling();\n\t\t\tnode.replaceWith(new Text(node.nodeValue));\n\t\t\treturn [node.nodeValue, next];\n\t\t}\n\t\tif (nodeType === 8 || nodeType === 7) {\n\t\t\tconst next = treeWalker.nextSibling();\n\t\t\tnode.remove();\n\t\t\treturn [null, next];\n\t\t}\n\n\t\tconst props = {};\n\t\tconst children = [];\n\t\tconst directives = {};\n\t\tlet hasDirectives = false;\n\t\tlet ignore = false;\n\t\tlet island = false;\n\n\t\tfor (let i = 0; i < attributes.length; i++) {\n\t\t\tconst n = attributes[i].name;\n\t\t\tif (\n\t\t\t\tn[fullPrefix.length] &&\n\t\t\t\tn.slice(0, fullPrefix.length) === fullPrefix\n\t\t\t) {\n\t\t\t\tif (n === ignoreAttr) {\n\t\t\t\t\tignore = true;\n\t\t\t\t} else if (n === islandAttr) {\n\t\t\t\t\tisland = true;\n\t\t\t\t} else {\n\t\t\t\t\thasDirectives = true;\n\t\t\t\t\tlet val = attributes[i].value;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tval = JSON.parse(val);\n\t\t\t\t\t} catch (e) {}\n\t\t\t\t\tconst [, prefix, suffix] = directiveParser.exec(n);\n\t\t\t\t\tdirectives[prefix] = directives[prefix] || {};\n\t\t\t\t\tdirectives[prefix][suffix || 'default'] = val;\n\t\t\t\t}\n\t\t\t} else if (n === 'ref') {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tprops[n] = attributes[i].value;\n\t\t}\n\n\t\tif (ignore && !island)\n\t\t\treturn [\n\t\t\t\th(node.localName, {\n\t\t\t\t\t...props,\n\t\t\t\t\tinnerHTML: node.innerHTML,\n\t\t\t\t\t__directives: { ignore: true },\n\t\t\t\t}),\n\t\t\t];\n\t\tif (island) hydratedIslands.add(node);\n\n\t\tif (hasDirectives) props.__directives = directives;\n\n\t\tlet child = treeWalker.firstChild();\n\t\tif (child) {\n\t\t\twhile (child) {\n\t\t\t\tconst [vnode, nextChild] = walk(child);\n\t\t\t\tif (vnode) children.push(vnode);\n\t\t\t\tchild = nextChild || treeWalker.nextSibling();\n\t\t\t}\n\t\t\ttreeWalker.parentNode();\n\t\t}\n\n\t\treturn [h(node.localName, props, children)];\n\t}\n\n\treturn walk(treeWalker.currentNode);\n}\n","import { hydrate, render } from 'preact';\nimport { toVdom, hydratedIslands } from './vdom';\nimport { createRootFragment } from './utils';\nimport { csnMetaTagItemprop, directivePrefix } from './constants';\n\n// The root to render the vdom (document.body).\nlet rootFragment;\n\n// The cache of visited and prefetched pages, stylesheets and scripts.\nconst pages = new Map();\nconst stylesheets = new Map();\nconst scripts = new Map();\n\n// Helper to remove domain and hash from the URL. We are only interesting in\n// caching the path and the query.\nconst cleanUrl = (url) => {\n\tconst u = new URL(url, window.location);\n\treturn u.pathname + u.search;\n};\n\n// Helper to check if a page can do client-side navigation.\nexport const canDoClientSideNavigation = (dom) =>\n\tdom\n\t\t.querySelector(`meta[itemprop='${csnMetaTagItemprop}']`)\n\t\t?.getAttribute('content') === 'active';\n\n/**\n * Finds the elements in the document that match the selector and fetch them.\n * For each element found, fetch the content and store it in the cache.\n * Returns an array of elements to add to the document.\n *\n * @param {Document}         document\n * @param {string}           selector        - CSS selector used to find the elements.\n * @param {'href'|'src'}     attribute       - Attribute that determines where to fetch\n *                                           the styles or scripts from. Also used as the key for the cache.\n * @param {Map}              cache           - Cache to use for the elements. Can be `stylesheets` or `scripts`.\n * @param {'style'|'script'} elementToCreate - Element to create for each fetched\n *                                           item. Can be 'style' or 'script'.\n * @return {Promise<Array<HTMLElement>>} - Array of elements to add to the document.\n */\nconst fetchScriptOrStyle = async (\n\tdocument,\n\tselector,\n\tattribute,\n\tcache,\n\telementToCreate\n) => {\n\tconst fetchedItems = await Promise.all(\n\t\t[].map.call(document.querySelectorAll(selector), (el) => {\n\t\t\tconst attributeValue = el.getAttribute(attribute);\n\t\t\tif (!cache.has(attributeValue))\n\t\t\t\tcache.set(\n\t\t\t\t\tattributeValue,\n\t\t\t\t\tfetch(attributeValue).then((r) => r.text())\n\t\t\t\t);\n\t\t\treturn cache.get(attributeValue);\n\t\t})\n\t);\n\n\treturn fetchedItems.map((item) => {\n\t\tconst element = document.createElement(elementToCreate);\n\t\telement.textContent = item;\n\t\treturn element;\n\t});\n};\n\n// Fetch styles of a new page.\nconst fetchAssets = async (document) => {\n\tconst stylesFromSheets = await fetchScriptOrStyle(\n\t\tdocument,\n\t\t'link[rel=stylesheet]',\n\t\t'href',\n\t\tstylesheets,\n\t\t'style'\n\t);\n\tconst scriptTags = await fetchScriptOrStyle(\n\t\tdocument,\n\t\t'script[src]',\n\t\t'src',\n\t\tscripts,\n\t\t'script'\n\t);\n\tconst moduleScripts = await fetchScriptOrStyle(\n\t\tdocument,\n\t\t'script[type=module]',\n\t\t'src',\n\t\tscripts,\n\t\t'script'\n\t);\n\tmoduleScripts.forEach((script) => script.setAttribute('type', 'module'));\n\n\treturn [\n\t\t...scriptTags,\n\t\tdocument.querySelector('title'),\n\t\t...document.querySelectorAll('style'),\n\t\t...stylesFromSheets,\n\t];\n};\n\n// Fetch a new page and convert it to a static virtual DOM.\nconst fetchPage = async (url) => {\n\tconst html = await window.fetch(url).then((r) => r.text());\n\tconst dom = new window.DOMParser().parseFromString(html, 'text/html');\n\tif (!canDoClientSideNavigation(dom.head)) return false;\n\tconst head = await fetchAssets(dom);\n\treturn { head, body: toVdom(dom.body) };\n};\n\n// Prefetch a page. We store the promise to avoid triggering a second fetch for\n// a page if a fetching has already started.\nexport const prefetch = (url) => {\n\turl = cleanUrl(url);\n\tif (!pages.has(url)) {\n\t\tpages.set(url, fetchPage(url));\n\t}\n};\n\n// Navigate to a new page.\nexport const navigate = async (href, { replace = false } = {}) => {\n\tconst url = cleanUrl(href);\n\tprefetch(url);\n\tconst page = await pages.get(url);\n\tif (page) {\n\t\tdocument.head.replaceChildren(...page.head);\n\t\trender(page.body, rootFragment);\n\t\twindow.history[replace ? 'replaceState' : 'pushState']({}, '', href);\n\t} else {\n\t\twindow.location.assign(href);\n\t}\n};\n\n// Listen to the back and forward buttons and restore the page if it's in the\n// cache.\nwindow.addEventListener('popstate', async () => {\n\tconst url = cleanUrl(window.location); // Remove hash.\n\tconst page = pages.has(url) && (await pages.get(url));\n\tif (page) {\n\t\tdocument.head.replaceChildren(...page.head);\n\t\trender(page.body, rootFragment);\n\t} else {\n\t\twindow.location.reload();\n\t}\n});\n\n// Initialize the router with the initial DOM.\nexport const init = async () => {\n\tif (canDoClientSideNavigation(document.head)) {\n\t\t// Create the root fragment to hydrate everything.\n\t\trootFragment = createRootFragment(\n\t\t\tdocument.documentElement,\n\t\t\tdocument.body\n\t\t);\n\t\tconst body = toVdom(document.body);\n\t\thydrate(body, rootFragment);\n\n\t\t// Cache the scripts. Has to be called before fetching the assets.\n\t\t[].map.call(document.querySelectorAll('script[src]'), (script) => {\n\t\t\tscripts.set(script.getAttribute('src'), script.textContent);\n\t\t});\n\n\t\tconst head = await fetchAssets(document);\n\t\tpages.set(cleanUrl(window.location), Promise.resolve({ body, head }));\n\t} else {\n\t\tdocument\n\t\t\t.querySelectorAll(`[data-${directivePrefix}-interactive]`)\n\t\t\t.forEach((node) => {\n\t\t\t\tif (!hydratedIslands.has(node)) {\n\t\t\t\t\tconst fragment = createRootFragment(node.parentNode, node);\n\t\t\t\t\tconst vdom = toVdom(node);\n\t\t\t\t\thydrate(vdom, fragment);\n\t\t\t\t}\n\t\t\t});\n\t}\n};\n","import { deepSignal } from 'deepsignal';\n\nconst isObject = (item) =>\n\titem && typeof item === 'object' && !Array.isArray(item);\n\nexport const deepMerge = (target, source) => {\n\tif (isObject(target) && isObject(source)) {\n\t\tfor (const key in source) {\n\t\t\tif (isObject(source[key])) {\n\t\t\t\tif (!target[key]) Object.assign(target, { [key]: {} });\n\t\t\t\tdeepMerge(target[key], source[key]);\n\t\t\t} else {\n\t\t\t\tObject.assign(target, { [key]: source[key] });\n\t\t\t}\n\t\t}\n\t}\n};\n\nconst getSerializedState = () => {\n\t// TODO: change the store tag ID for a better one.\n\tconst storeTag = document.querySelector(\n\t\t`script[type=\"application/json\"]#store`\n\t);\n\tif (!storeTag) return {};\n\ttry {\n\t\tconst { state } = JSON.parse(storeTag.textContent);\n\t\tif (isObject(state)) return state;\n\t\tthrow Error('Parsed state is not an object');\n\t} catch (e) {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.log(e);\n\t}\n\treturn {};\n};\n\nconst rawState = getSerializedState();\nexport const rawStore = { state: deepSignal(rawState) };\n\nif (typeof window !== 'undefined') window.store = rawStore;\n\nexport const store = ({ state, ...block }) => {\n\tdeepMerge(rawStore, block);\n\tdeepMerge(rawState, state);\n};\n","import { useRef, useEffect } from 'preact/hooks';\nimport { effect } from '@preact/signals';\n\nfunction afterNextFrame(callback) {\n\tconst done = () => {\n\t\tcancelAnimationFrame(raf);\n\t\tsetTimeout(callback);\n\t};\n\tconst raf = requestAnimationFrame(done);\n}\n\n// Using the mangled properties:\n// this.c: this._callback\n// this.x: this._compute\n// https://github.com/preactjs/signals/blob/main/mangle.json\nfunction createFlusher(compute, notify) {\n\tlet flush;\n\tconst dispose = effect(function () {\n\t\tflush = this.c.bind(this);\n\t\tthis.x = compute;\n\t\tthis.c = notify;\n\t\treturn compute();\n\t});\n\treturn { flush, dispose };\n}\n\n// Version of `useSignalEffect` with a `useEffect`-like execution. This hook\n// implementation comes from this PR:\n// https://github.com/preactjs/signals/pull/290.\n//\n// We need to include it here in this repo until the mentioned PR is merged.\nexport function useSignalEffect(cb) {\n\tconst callback = useRef(cb);\n\tcallback.current = cb;\n\n\tuseEffect(() => {\n\t\tconst execute = () => callback.current();\n\t\tconst notify = () => afterNextFrame(eff.flush);\n\t\tconst eff = createFlusher(execute, notify);\n\t\treturn eff.dispose;\n\t}, []);\n}\n\n// For wrapperless hydration.\n// See https://gist.github.com/developit/f4c67a2ede71dc2fab7f357f39cff28c\nexport const createRootFragment = (parent, replaceNode) => {\n\treplaceNode = [].concat(replaceNode);\n\tconst s = replaceNode[replaceNode.length - 1].nextSibling;\n\tfunction insert(c, r) {\n\t\tparent.insertBefore(c, r || s);\n\t}\n\treturn (parent.__k = {\n\t\tnodeType: 1,\n\t\tparentNode: parent,\n\t\tfirstChild: replaceNode[0],\n\t\tchildNodes: replaceNode,\n\t\tinsertBefore: insert,\n\t\tappendChild: insert,\n\t\tremoveChild(c) {\n\t\t\tparent.removeChild(c);\n\t\t},\n\t});\n};\n"],"names":["context","createContext","directiveMap","directivePriorities","directive","name","cb","priority","Directive","type","directives","props","originalProps","ref","useRef","element","h","evaluate","useMemo","path","extraArgs","hasNegationOperator","slice","value","ctx","current","store","split","forEach","p","resolve","returnValue","getEvaluate","byPriorityLevel","byPriority","Object","entries","reduce","acc","values","sort","p1","p2","map","obj","usePriorityLevels","RecursivePriorityLevel","rest","cloneElement","children","length","directiveArgs","d","wrapper","undefined","old","options","vnode","__directives","clientSideNavigation","canDoClientSideNavigation","document","head","isObject","item","Array","isArray","mergeDeepSignals","target","source","k","peek","addEventListener","async","default","inherited","Provider","inheritedValue","useContext","localValue","deepSignal","effect","contextValue","useSignalEffect","on","event","class","className","keys","filter","n","result","currentClass","classFinder","RegExp","test","replace","trim","useEffect","classList","add","remove","bind","attribute","removeAttribute","setAttribute","link","href","prefetch","onclick","preventDefault","navigate","scroll","window","scrollTo","top","left","behavior","show","Type","innerHTML","cached","dangerouslySetInnerHTML","__html","text","init","console","log","fullPrefix","directiveParser","hydratedIslands","WeakSet","toVdom","root","treeWalker","createTreeWalker","walk","node","attributes","nodeType","data","next","nextSibling","replaceWith","Text","nodeValue","hasDirectives","ignore","island","i","val","JSON","parse","e","prefix","suffix","exec","localName","child","firstChild","nextChild","push","parentNode","currentNode","rootFragment","pages","Map","stylesheets","scripts","cleanUrl","url","u","URL","location","pathname","search","dom","querySelector","getAttribute","fetchScriptOrStyle","selector","cache","elementToCreate","Promise","all","call","querySelectorAll","el","attributeValue","has","set","fetch","then","r","get","createElement","textContent","fetchAssets","stylesFromSheets","scriptTags","script","html","DOMParser","parseFromString","body","fetchPage","page","replaceChildren","render","history","assign","reload","createRootFragment","documentElement","hydrate","fragment","vdom","deepMerge","key","rawState","storeTag","state","Error","getSerializedState","rawStore","block","callback","eff","compute","notify","flush","dispose","this","c","x","createFlusher","raf","requestAnimationFrame","cancelAnimationFrame","setTimeout","afterNextFrame","parent","replaceNode","s","concat","insert","insertBefore","__k","childNodes","appendChild","removeChild"],"sourceRoot":""}